var requestWebcam=function(c){this.defaults={video_in:null,video_out:null,name:["video_",(new Date()+"").slice(4,28),".mp4"].join(""),onGetPermission:function(){},onForgetPermission:function(){},onDeniedPermission:function(d){console.log(d.name+": "+d.message);
},onStartRecording:function(){},onStopRecording:function(){},onDownload:function(){}};for(var b in this.defaults){this[b]=(c[b]!==undefined)?c[b]:this.defaults[b];
}this.data_array=[];this.stream=null;this.recorder=null;this.blob=null;this.browser=navigator.userAgent;};requestWebcam.prototype.getVideo_in=function(){return this.video_in;
};requestWebcam.prototype.getVideo_out=function(){return this.video_out;};requestWebcam.prototype.getName=function(){return this.name;};requestWebcam.prototype.getOnGetPermission=function(){return this.onGetPermission;
};requestWebcam.prototype.getOnForgetPermission=function(){return this.onForgetPermission;};requestWebcam.prototype.getOnDeniedPermission=function(){return this.onDeniedPermission;
};requestWebcam.prototype.getOnStartRecording=function(){return this.onStartRecording;};requestWebcam.prototype.getOnStopRecording=function(){return this.onStopRecording;
};requestWebcam.prototype.getOnDownload=function(){return this.onDownload;};requestWebcam.prototype.getData_array=function(){return this.data_array;};requestWebcam.prototype.getStream=function(){return this.stream;
};requestWebcam.prototype.getRecorder=function(){return this.recorder;};requestWebcam.prototype.getBlob=function(){return this.blob;};requestWebcam.prototype.forgetPermission=function(){for(var b=0;
b<this.stream.getTracks().length;b++){this.stream.getTracks()[b].stop();}if(this.onForgetPermission&&typeof this.onForgetPermission==="function"){this.onForgetPermission();
}};requestWebcam.prototype.requestPermission=function(){var b=this;navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(function(c){b.stream=c;
if(b.video_in){b.video_in.src=URL.createObjectURL(b.stream);}if(b.onGetPermission&&typeof b.onGetPermission==="function"){b.onGetPermission();}}).then(null,b.onDeniedPermission&&typeof b.onDeniedPermission==="function"?b.onDeniedPermission:function(c){console.log(c.name+": "+c.message);
});};requestWebcam.prototype.startRecording=function(){var b=this;if(this.browser.indexOf("Chrome")>-1){if(b.onStartRecording&&typeof b.onStartRecording==="function"){b.onStartRecording();
}b.recorder=new MediaRecorder(b.stream);b.recorder.ondataavailable=function(c){b.data_array.push(c.data);};b.recorder.start();}else{if(b.browser.indexOf("Firefox")>-1||b.browser.indexOf("Opera")>-1){if(b.onStartRecording&&typeof b.onStartRecording==="function"){b.onStartRecording();
}b.recorder=new MediaRecorder(b.stream);b.recorder.start();}else{if(b.onStartRecording&&typeof b.onStartRecording==="function"){b.onStartRecording();}b.recorder=new MediaRecorder(b.stream);
b.recorder.start();b.recorder.ondataavailable=function(c){b.data_array.push(c.data);};}}};requestWebcam.prototype.stopRecording=function(){var b=this;if(b.browser.indexOf("Chrome")>-1){b.promise=new Promise(function(c){b.recorder.stop();
b.interval=setInterval(function(){if(b.data_array.length>0){clearInterval(b.interval);c(b.data_array);}},100);});b.promise.then(function(c){b.blob=new Blob(c,{type:"video/mp4"});
b.urlobj=URL.createObjectURL(b.blob);if(b.video_out){b.video_out.src=URL.createObjectURL(b.blob);}if(b.onStopRecording&&typeof b.onStopRecording==="function"){setTimeout(b.onStopRecording(),50);
}b.data_array=[];});}else{if(b.browser.indexOf("Firefox")>-1||b.browser.indexOf("Opera")>-1){b.recorder.ondataavailable=function(c){b.urlobj=URL.createObjectURL(c.data);
b.blob=new Blob([c.data],{type:"video/mp4"});if(b.video_out){b.video_out.src=URL.createObjectURL(c.data);}if(b.onStopRecording&&typeof b.onStopRecording==="function"){setTimeout(b.onStopRecording(),50);
}};b.recorder.stop();}else{b.recorder.stop();b.blob=new Blob(b.data_array,{type:"video/mp4"});b.urlobj=URL.createObjectURL(b.blob);if(b.video_out){b.video_out.src=URL.createObjectURL(b.blob);
}if(b.onStopRecording&&typeof b.onStopRecording==="function"){setTimeout(b.onStopRecording(),50);}b.data_array=[];}}};requestWebcam.prototype.download=function(){var b=this;
if(b.onDownload&&typeof b.onDownload==="function"){b.onDownload();}a=document.createElement("a");a.style="display: none";a.download=b.name;a.href=b.urlobj;
a.textContent=a.download;document.body.appendChild(a);a.click();setTimeout(function(){document.body.removeChild(a);URL.revokeObjectURL(a.href);},200);};
